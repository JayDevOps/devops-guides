FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGRldm9wcy13b3Jrc2hvcC1hcGIKZGVzY3JpcHRpb246IEFQQiB0\
byBkZXBsb3kgcmVxdWlyZWQgaW5mcmEgY29tcG9uZW50cyBmb3IgdGhlIERldk9wcyBXb3Jrc2hv\
cCBvbiBhbiBPcGVuU2hpZnQgY2x1c3RlcgpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFs\
CnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRhdGE6CiAgZGVwZW5kZW5jaWVzOiBbXQogIGRpc3BsYXlO\
YW1lOiAiRGV2T3BzIFdvcmtzaG9wIEluc3RhbGxlciIKICBsb25nRGVzY3JpcHRpb246ICJJbnN0\
YWxscyB0aGUgbGFiIGluc3RydWN0aW9ucyBhbmQgcmVxdWlyZWQgY29tcG9uZW50cyAoR2l0IHNl\
cnZlciwgZXRjKSBmb3IgcnVubmluZyB0aGUgRGV2T3BzIFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHVi\
LmNvbS9vcGVuc2hpZnQtbGFicy9kZXZvcHMtZ3VpZGVzIgogIGNvbnNvbGUub3BlbnNoaWZ0Lmlv\
L2ljb25DbGFzczogInBmaWNvbiBwZmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVy\
RGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAg\
IGRlc2NyaXB0aW9uOiBEZXBsb3lzIERldk9wcyBXb3Jrc2hvcCBJbmZyYXN0cnVjdHVyZQogICAg\
ZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZhdWx0CiAgICBw\
YXJhbWV0ZXJzOgogICAgLSBuYW1lOiBvcGVuc2hpZnRfYWRtaW5fdXNlcgogICAgICB0aXRsZTog\
VXNlcm5hbWUKICAgICAgZGVzY3JpcHRpb246IEFkbWluIHVzZXIgaXMgcmVxdWlyZWQgZm9yIGNy\
ZWF0aW5nIGNsdXN0ZXIgcmVzb3VyY2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgQWRtaW4KICAgIC0gbmFtZTog\
b3BlbnNoaWZ0X2FkbWluX3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNj\
cmlwdGlvbjogQWRtaW4gcGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIGNsdXN0ZXIg\
cmVzb3VyY2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBk\
aXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1p\
bgogICAgLSBuYW1lOiBvcGVuc2hpZnRfbWFzdGVyX3VybAogICAgICB0aXRsZTogT3BlblNoaWZ0\
IE1hc3RlciBVUkwKICAgICAgZGVzY3JpcHRpb246IFRoZSBhZGRyZXNzIHRvIE9wZW5TaGlmdCBt\
YXN0ZXIgVVJMIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50\
cwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90\
eXBlOiBzdHJpbmcKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRlCiAgICAtIG5hbWU6IG9w\
ZW5zaGlmdF91c2VyX3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgVXNlciBQYXNzd29y\
ZAogICAgICBkZXNjcmlwdGlvbjogVGhlIE9wZW5TaGlmdCBwYXNzd29yZCBmb3IgcGFydGljaXBh\
bnRzIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBz\
dHJpbmcKICAgICAgdmFsdWU6ICJyM2RoNHQxISIKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1\
aWRlCiAgICAtIG5hbWU6IGdpdGh1Yl9yZWYKICAgICAgdGl0bGU6IEd1aWRlcyBHaXRIdWIgUmVm\
ZXJlbmNlCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgR2l0SHViIHJlZmVyZW5jZSBmb3IgdGhlIERl\
dk9wcyB3b3Jrc2hvcCBsYWIgZ3VpZGUKICAgICAgdHlwZTogZW51bQogICAgICBlbnVtOiBbIm9j\
cC0zLjkiXQogICAgICBkZWZhdWx0OiBvY3AtMy45CiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IGRpc3BsYXlfdHlwZTogc2VsZWN0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYiBHdWlkZQogICAg\
LSBuYW1lOiBwcm9qZWN0X3N1ZmZpeAogICAgICB0aXRsZTogVXNlciBQcm9qZWN0IFN1ZmZpeAog\
ICAgICBkZXNjcmlwdGlvbjogVGhlIHBhdHRlcm4gdXNlZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHNo\
b3cgdGhlIHVzZXIgcHJvamVjdHMgZS5nLiBjb29sc3RvcmUtWCAKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIGRlZmF1bHQ6ICJYIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X2dy\
b3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogZ29nc19hZG1fdXNlcgogICAgICB0aXRsZTogQWRt\
aW4gVXNlcgogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgR29ncyBHaXQgU2VydmVy\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiZ29ncyIKICAgICAgcmVxdWlyZWQ6\
IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogR2l0IFNlcnZlcgogICAgLSBuYW1lOiBnb2dzX2Fk\
bV9wd2QKICAgICAgdGl0bGU6IEFkbWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBQYXNz\
d29yZCBmb3IgR29ncyBhZG1pbiB1c2VyCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0\
OiAiZ29ncyIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogR2l0IFNl\
cnZlcgogICAgLSBuYW1lOiBnb2dzX2dlbl91c2VyX2NvdW50CiAgICAgIHRpdGxlOiBHZW5lcmF0\
ZWQgVXNlciBDb3VudAogICAgICBkZXNjcmlwdGlvbjogTnVtYmVyIG9mIEdvZ3MgdXNlciB0byBi\
ZSBjcmVhdGVkCiAgICAgIHR5cGU6IGludAogICAgICBkZWZhdWx0OiAxMDAKICAgICAgcmVxdWly\
ZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogR2l0IFNlcnZlcgogICAgLSBuYW1lOiBnb2dz\
X2dlbl91c2VyX2Zvcm1hdAogICAgICB0aXRsZTogR2VuZXJhdGVkIFVzZXIgRm9ybWF0CiAgICAg\
IGRlc2NyaXB0aW9uOiBUaGUgcHJpbnRmIGZvcm1hdCB0byBiZSB1c2VkIHdoZW4gY3JlYXRpbmcg\
R29ncyB1c2Vycy4gUmVhZCBtb3JlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1ByaW50\
Zl9mb3JtYXRfc3RyaW5nIAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogInVzZXIl\
ZCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogR2l0IFNlcnZlcgog\
ICAgLSBuYW1lOiBnb2dzX2dlbl91c2VyX2Zvcm1hdF9kaXNwbGF5CiAgICAgIHRpdGxlOiBHZW5l\
cmF0ZWQgVXNlciBGb3JtYXQgKERpc3BsYXkpCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgR29ncyB1\
c2VybmFtZSB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGxhYiBndWlkZQogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgZGVmYXVsdDogInVzZXJYIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNw\
bGF5X2dyb3VwOiBHaXQgU2VydmVyCiAgICAtIG5hbWU6IGdvZ3NfZ2VuX3VzZXJfcHdkCiAgICAg\
IHRpdGxlOiBHZW5lcmF0ZWQgVXNlciBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogUGFzc3dv\
cmQgZm9yIEdvZ3MgdXNlcnMgY3JlYXRlZAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVs\
dDogImdvZ3MiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEdpdCBT\
ZXJ2ZXIKICAgICAg"





COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
