FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGRldm9wcy13b3Jrc2hvcC1hcGIKZGVzY3JpcHRpb246IEFQQiB0\
byBkZXBsb3kgcmVxdWlyZWQgaW5mcmEgY29tcG9uZW50cyBmb3IgdGhlIERldk9wcyBXb3Jrc2hv\
cCBvbiBhbiBPcGVuU2hpZnQgY2x1c3RlcgpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFs\
CnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRhdGE6CiAgZGVwZW5kZW5jaWVzOiBbXQogIGRpc3BsYXlO\
YW1lOiAiRGV2T3BzIFdvcmtzaG9wIEluc3RhbGxlciIKICBsb25nRGVzY3JpcHRpb246ICJJbnN0\
YWxscyB0aGUgcmVxdWlyZWQgY29tcG9uZW50cyAoR2l0IHNlcnZlciwgZXRjKSBmb3IgcnVubmlu\
ZyB0aGUgRGV2T3BzIFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVuc2hpZnQtbGFicy9k\
ZXZvcHMtZ3VpZGVzIgogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogInBmaWNvbiBw\
Zmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0\
LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3lz\
IERldk9wcyBXb3Jrc2hvcCBJbmZyYXN0cnVjdHVyZQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRh\
dGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZhdWx0CiAgICBwYXJhbWV0ZXJzOgogICAgLSBuYW1l\
OiBvcGVuc2hpZnRfYWRtaW5fdXNlcgogICAgICB0aXRsZTogVXNlcm5hbWUKICAgICAgZGVzY3Jp\
cHRpb246IEFkbWluIHVzZXIgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIGNsdXN0ZXIgcmVzb3Vy\
Y2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5\
X2dyb3VwOiBPcGVuU2hpZnQgQWRtaW4KICAgIC0gbmFtZTogb3BlbnNoaWZ0X2FkbWluX3Bhc3N3\
b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gcGFzc3dv\
cmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIGNsdXN0ZXIgcmVzb3VyY2VzCiAgICAgIHR5cGU6\
IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3Jk\
CiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1pbgogICAgLSBuYW1lOiBnaXRodWJf\
cmVmCiAgICAgIHRpdGxlOiBHdWlkZXMgR2l0SHViIFJlZmVyZW5jZQogICAgICBkZXNjcmlwdGlv\
bjogVGhlIEdpdEh1YiByZWZlcmVuY2UgZm9yIHRoZSBDbG91ZC1OYXRpdmUgd29ya3Nob3AgbGFi\
IGd1aWRlCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWyJvY3AtMy45Il0KICAgICAgZGVm\
YXVsdDogb2NwLTMuOQogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHNl\
bGVjdAogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogcHJvamVjdF9z\
dWZmaXgKICAgICAgdGl0bGU6IFVzZXIgUHJvamVjdCBTdWZmaXgKICAgICAgZGVzY3JpcHRpb246\
IFRoZSBwYXR0ZXJuIHVzZWQgaW4gdGhlIGxhYiBndWlkZSB0byBzaG93IHRoZSB1c2VyIHByb2pl\
Y3RzIGUuZy4gY29vbHN0b3JlLVggCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAi\
WCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRlCiAg\
ICAtIG5hbWU6IGdvZ3NfYWRtX3VzZXIKICAgICAgdGl0bGU6IEFkbWluIFVzZXIKICAgICAgZGVz\
Y3JpcHRpb246IEFkbWluIHVzZXIgZm9yIEdvZ3MgR2l0IFNlcnZlcgogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgZGVmYXVsdDogImdvZ3MiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3Bs\
YXlfZ3JvdXA6IEdpdCBTZXJ2ZXIKICAgIC0gbmFtZTogZ29nc19hZG1fcHdkCiAgICAgIHRpdGxl\
OiBBZG1pbiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogUGFzc3dvcmQgZm9yIEdvZ3MgYWRt\
aW4gdXNlcgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogImdvZ3MiCiAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEdpdCBTZXJ2ZXIKICAgIC0gbmFtZTog\
Z29nc19nZW5fdXNlcl9jb3VudAogICAgICB0aXRsZTogR2VuZXJhdGVkIFVzZXIgQ291bnQKICAg\
ICAgZGVzY3JpcHRpb246IE51bWJlciBvZiBHb2dzIHVzZXIgdG8gYmUgY3JlYXRlZAogICAgICB0\
eXBlOiBpbnQKICAgICAgZGVmYXVsdDogMTAwCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRp\
c3BsYXlfZ3JvdXA6IEdpdCBTZXJ2ZXIKICAgIC0gbmFtZTogZ29nc19nZW5fdXNlcl9mb3JtYXQK\
ICAgICAgdGl0bGU6IEdlbmVyYXRlZCBVc2VyIEZvcm1hdAogICAgICBkZXNjcmlwdGlvbjogVGhl\
IHByaW50ZiBmb3JtYXQgdG8gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIEdvZ3MgdXNlcnMuIFJlYWQg\
bW9yZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QcmludGZfZm9ybWF0X3N0cmluZyAK\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJ1c2VyJWQiCiAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEdpdCBTZXJ2ZXIKICAgIC0gbmFtZTogZ29nc19n\
ZW5fdXNlcl9mb3JtYXRfZGlzcGxheQogICAgICB0aXRsZTogR2VuZXJhdGVkIFVzZXIgRm9ybWF0\
IChEaXNwbGF5KQogICAgICBkZXNjcmlwdGlvbjogVGhlIEdvZ3MgdXNlcm5hbWUgdG8gYmUgZGlz\
cGxheWVkIGluIHRoZSBsYWIgZ3VpZGUKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6\
ICJ1c2VyWCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogR2l0IFNl\
cnZlcgogICAgLSBuYW1lOiBnb2dzX2dlbl91c2VyX3B3ZAogICAgICB0aXRsZTogR2VuZXJhdGVk\
IFVzZXIgUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIGZvciBHb2dzIHVzZXJz\
IGNyZWF0ZWQKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJnb2dzIgogICAgICBy\
ZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X2dyb3VwOiBHaXQgU2VydmVyCiAgICAgIA=="

COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
